<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default}">

<body>
<main layout:fragment="content">
    <div class="container-fluid p-0">

        <div class="mb-3">
            <h1 class="h3 d-inline align-middle">Profile</h1>
            <a class="badge bg-dark text-white ms-2" href="upgrade-to-pro.html">
                Get more page examples
            </a>
        </div>
        <div class="row">
            <div class="col-md-4 col-xl-3">
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Profile Details</h5>
                    </div>
                    <div class="card-body text-center">
                        <img src="img/avaad.png" alt="Christina Mason" class="img-fluid rounded-circle mb-2"
                             width="128" height="128"/>
                        <h5 class="card-title mb-0">Dao Phu Hung</h5>
                        <div class="text-muted mb-2">ADMIN</div>

                        <div>
                            <a class="btn btn-primary btn-sm" href="#"><span data-feather="message-square"></span>
                                Message</a>
                        </div>
                    </div>
                    <hr class="my-0"/>
                    <div class="card-body">
                        <h5 class="h6 card-title">About</h5>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-1"><span data-feather="home" class="feather-sm me-1"></span> Lives in <a
                                    href="#">San Francisco, SA</a></li>

                            <li class="mb-1"><span data-feather="briefcase" class="feather-sm me-1"></span> Works at <a
                                    href="#">GitHub</a></li>
                            <li class="mb-1"><span data-feather="map-pin" class="feather-sm me-1"></span> From <a
                                    href="#">Boston</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-xl-7">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Activities</h5>
                    </div>
                </div>
                <div class="list-group">
                    <div th:each="diary : ${diaries}" class="list-group-item">
                        <div class="row g-0 align-items-center">
                            <div class="col-2">
                                <img th:src="${diary.avatar}" class="avatar img-fluid rounded-circle" alt="User Avatar">
                            </div>
                            <div class="col-10 ps-2">
                                <div class="text-dark" th:text="${diary.nickname}"></div>
                                <div class="text-muted small mt-1" th:text="${diary.happened}"></div>
                                <div class="text-muted small mt-1"
                                     th:text="${#dates.format(diary.createdAt, 'HH:mm')} ago"></div>
                            </div>
                        </div>
                    </div>
<!--                    <a href="#" class="list-group-item">-->
<!--                        <div class="row g-0 align-items-center">-->
<!--                            <div class="col-2">-->
<!--                                <img src="img/avatars/avatar-2.jpg" class="avatar img-fluid rounded-circle"-->
<!--                                     alt="William Harris">-->
<!--                            </div>-->
<!--                            <div class="col-10 ps-2">-->
<!--                                <div class="text-dark">William Harris</div>-->
<!--                                <div class="text-muted small mt-1">Curabitur ligula sapien euismod vitae.-->
<!--                                </div>-->
<!--                                <div class="text-muted small mt-1">2h ago</div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </a>-->
                </div>
            </div>

            <div class="col-md-4 col-xl-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Pie Chart</h5>
                        <h6 class="card-subtitle text-muted">Pie charts are excellent at showing the relational proportions between data.</h6>
                    </div>
                    <div class="card-body">
                        <div class="chart chart-sm">
                            <canvas id="chartjs-pie"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</main>

<script src="js/app.js"></script>
<script>
    console.log("abc");
    document.addEventListener("DOMContentLoaded", function () {
        const options = {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + readCookie('token')
            },
        };
        fetch('http://localhost:8080/api/v1/diary/countByMoodAndCreatedBy/1', options)

            .then(response => response.json())
            .then(data => {

                const labels = data.data.map(entry => entry[1]);
                const values = data.data.map(entry => entry[0]);
                const themes = [
                    window.theme.primary,
                    window.theme.warning,
                    window.theme.danger,
                    window.theme.info,
                    window.theme.secondary,
                    window.theme.success,
                    window.theme.Link,
                    "#dee2e6",

                ];


                const backgroundColors = themes.slice(0, labels.length);

                new Chart(document.getElementById("chartjs-pie"), {
                    type: "pie",
                    data: {
                        labels: labels,
                        datasets: [{
                            data: values,
                            backgroundColor: backgroundColors,
                            borderColor: "transparent"
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        legend: {
                            display: false
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching data:', error));
    });

    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
</script>

</body>

</html>